var __extends=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])};return function(e,n){function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),Binding;!function(t){function e(t){return"object"==typeof t}function n(t){var r;if(t.PropertyChanged&&(r=t.plain()),e(t)&&(r=t),r){var i={};return $.each(r,function(t,e){i[t]=n(e)}),i}var o;if(t.CollectionChanged&&(o=t.all()),Array.isArray(t)&&(o=t),o){var a=[];return $.each(o,function(t,e){a[t]=n(e)}),a}return t}function r(t){if(Array.isArray(t)){var n=[];return $.each(t,function(t,e){n[t]=r(e)}),new s(n)}if(e(t)){var i={};return $.each(t,function(t,e){i[t]=r(e)}),new u(i)}return t}function i(t,e,n){switch(void 0===n&&(n={property:a.PROPERTY_TYPE_CONTEXT}),n.property){case a.PROPERTY_TYPE_CONTEXT:return void new y(e,t);case a.PROPERTY_TYPE_COMMAND:return void new d(e,n.path,t,n.property,n.trigger,n.parameter);case a.PROPERTY_TYPE_ITEMS:return void new f(e,n.path,t,n.property,n.converter);default:return void new l(e,n.path,t,n.property,n.mode,n.trigger,n.converter)}}var o={},a=function(){function t(){}return t.COLLECTION_ACTION_ADD="add",t.COLLECTION_ACTION_INSERT="insert",t.COLLECTION_ACTION_CLEAR="clear",t.COLLECTION_ACTION_REMOVE="remove",t.PROPERTY_TYPE_COMMAND="command",t.PROPERTY_TYPE_ITEMS="items",t.PROPERTY_TYPE_CONTEXT="context",t}();t.Constants=a;var c=function(){function t(t){void 0===t&&(t=[]),this.onCollectionChanged=new h,this.data=t}return t.prototype.add=function(t){var e=this.data.length;return this.data[e]=t,this.onCollectionChanged.trigger({action:a.COLLECTION_ACTION_ADD,index:e,item:t}),this},t.prototype.insert=function(t,e){return this.data.splice(t,0,e),this.onCollectionChanged.trigger({action:a.COLLECTION_ACTION_INSERT,index:t,item:e}),this},t.prototype.remove=function(t){return this.data.splice(t,1),this.onCollectionChanged.trigger({action:a.COLLECTION_ACTION_REMOVE,index:t}),this},t.prototype.clear=function(){return this.data.length=0,this.onCollectionChanged.trigger({action:a.COLLECTION_ACTION_CLEAR}),this},t.prototype.all=function(){return this.data},t.prototype.itemAt=function(t){return this.data[t]},Object.defineProperty(t.prototype,"CollectionChanged",{get:function(){return this.onCollectionChanged.expose()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"length",{get:function(){return this.data.length},enumerable:!0,configurable:!0}),t}();t.TypedObservableCollection=c;var s=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e}(c);t.ObservableCollection=s;var u=function(){function t(t){void 0===t&&(t={});var e=this;this.data={},this.onPropertyChanged=new h,$.each(t,function(t,n){n instanceof Function?e.addCommand(t,n):e.addProperty(t,n)})}return t.prototype.addProperty=function(t,e){var n=this;return this.data[t]=e,Object.defineProperty(this,t,{get:function(){return n.data[t]},set:function(e){n.data[t]!==e&&(n.data[t]=e,n.onPropertyChanged.trigger({property:t,value:e}))}}),this},t.prototype.addCommand=function(t,e){return this[t]=e,this},Object.defineProperty(t.prototype,"PropertyChanged",{get:function(){return this.onPropertyChanged.expose()},enumerable:!0,configurable:!0}),t.prototype.plain=function(){return this.data},t}();t.NotifyPropertyChanged=u;var h=function(){function t(){this.handlers=[]}return t.prototype.on=function(t){this.handlers.push(t)},t.prototype.off=function(t){this.handlers=this.handlers.filter(function(e){return e!==t})},t.prototype.trigger=function(t){this.handlers.slice(0).forEach(function(e){return e(t)})},t.prototype.expose=function(){return this},t}(),p=function(){function t(t,e,n,r,i){if(void 0===i&&(i=null),"^"===e.substr(0,1)){for(var a=n.closest("*[data-binding-context=context]");"^"===e.substr(0,1);)e=e.substr(1),a=a.parent().closest("*[data-binding-context=context]");t=a.data("binding-ctx")}this.context=t,this.pathParts=e?e.split("."):[],this.jquery=n,this.property=r,this.converter=i?o[i]:null}return Object.defineProperty(t.prototype,"CtxValue",{get:function(){var t=this,e=this.context;return $.each(this.pathParts,function(n,r){if(void 0===e)return console.error("Path "+t.pathParts.join(".")+" does not exist!"),null;e=e[r]}),this.converter&&(e=this.converter.converter(e)),e},set:function(t){for(var e=this.context,n=0;n<this.pathParts.length-2;n++)e=e[this.pathParts[n]];this.converter&&this.converter.backConverter&&(t=this.converter.backConverter(t)),e[this.CtxProperty]=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"CtxProperty",{get:function(){return 0===this.pathParts.length?null:this.pathParts[this.pathParts.length-1]},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"CtxPath",{get:function(){return this.pathParts.join(".")},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"Ctx",{get:function(){return this.context},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"UiProperty",{get:function(){return this.property},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"Jquery",{get:function(){return this.jquery},enumerable:!0,configurable:!0}),t}(),l=function(t){function e(e,n,r,i,o,a,c){void 0===c&&(c=null);var s=t.call(this,e,n,r,i,c)||this;return s.setToUi(),e.PropertyChanged&&"set"!==o&&e.PropertyChanged.on(function(t){s.CtxProperty===t.property&&s.setToUi()}),"get"!==o&&s.Jquery.on(a||"change",function(t){s.getFromUi()}),s}return __extends(e,t),e.prototype.getFromUi=function(){switch(this.UiProperty){case"val":case"value":this.CtxValue=this.Jquery.val();break;case"checked":this.CtxValue=this.Jquery.is(":checked")}},e.prototype.setToUi=function(){switch(this.UiProperty){case"val":case"value":this.Jquery.val(this.CtxValue);break;case"checked":this.Jquery.prop("checked",this.CtxValue?"checked":null);break;case"text":this.Jquery.text(this.CtxValue);break;case"visibility":this.Jquery.css("display",this.CtxValue?"":"none");break;case"enabled":this.Jquery.attr("disabled",this.CtxValue?null:"disabled");break;default:if("style."===this.UiProperty.substr(0,6).toLowerCase()){var t=this.UiProperty.substr(6);this.Jquery.css(t,this.CtxValue);break}}},e}(p),d=function(t){function e(e,n,r,i,o,a){var c=t.call(this,e,n,r,i)||this;return c.parameter=a,r.on(o||"click",function(t){c.call()}),c}return __extends(e,t),e.prototype.call=function(){var t=this.CtxValue;t?t.apply(this.Ctx,[this.parameter]):console.error("Path "+this.CtxPath+" does not exist!")},e}(p),f=function(t){function e(e,n,r,i,o){void 0===o&&(o=null);var c=t.call(this,e,n,r,i,o)||this;if(c.Jquery.data("binding-ctx",e).attr("data-binding-context","context"),c.template=r.data("binding-template"),!c.template){var s=r.children().first();c.template=s[0].outerHTML,s.remove()}var u=c.CtxValue;return $.each(u.all()||u,function(t,e){c.addElement(e,t)}),u.CollectionChanged&&u.CollectionChanged.on(function(t){switch(t.action){case a.COLLECTION_ACTION_ADD:c.addElement(t.item,t.index);break;case a.COLLECTION_ACTION_INSERT:var e=c.addElement(t.item,t.index);0===t.index?c.Jquery.prepend(e):c.Jquery.children(":nth-child("+t.index+")").after(e);break;case a.COLLECTION_ACTION_REMOVE:c.Jquery.children(":nth-child("+(t.index+1)+")").remove();break;case a.COLLECTION_ACTION_CLEAR:r.empty()}}),c}return __extends(e,t),e.prototype.addElement=function(t,e){var n=this.template.replace(/\{\{([^\}]*)\}\}/gi,function(e){for(var n=[],r=1;r<arguments.length;r++)n[r-1]=arguments[r];var i=n[0];return t[i]}),r=$(n);return this.Jquery.append(r),i(r,t),r},e}(p),y=function(){function t(t,e){this.context=t,this.jquery=e,this.jquery.data("binding-ctx",t).attr("data-binding-context","context"),this.parseElements()}return t.prototype.parseElements=function(){var t=this;this.jquery.find("*[data-binding]").each(function(e,n){var r=$(n),o=r.data("binding").split("|");$.each(o,function(e,n){var o=t.parseOptions(n);i(r,t.context,o)})})},t.prototype.parseOptions=function(t){var e,n=/([^:]*):([^;]*)[;]{0,1}/gi,r={};do{(e=n.exec(t))&&(r[e[1]]=e[2])}while(e);return r},t}();t.registerConverter=function(t,e,n){void 0===n&&(n=null),o[t]={converter:e,backConverter:n}},t.simplifyObject=n,t.bindableObject=r,t.initialize=i}(Binding||(Binding={})),function(t,e){if(!e)return!1;e.fn.extend({binding:function(t,e){return void 0===e&&(e={property:Binding.Constants.PROPERTY_TYPE_CONTEXT}),Binding.initialize(this,t,e),this}})}(window,jQuery);