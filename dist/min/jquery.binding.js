var __extends=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])};return function(e,r){function n(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),Binding;!function(t){function e(t){return"object"==typeof t}function r(t){var n;if(t.PropertyChanged&&(n=t.plain()),e(t)&&(n=t),n){var i={};return $.each(n,function(t,e){i[t]=r(e)}),i}var o;if(t.CollectionChanged&&(o=t.all()),Array.isArray(t)&&(o=t),o){var a=[];return $.each(o,function(t,e){a[t]=r(e)}),a}return t}function n(t){if(Array.isArray(t)){var r=[];return $.each(t,function(t,e){r[t]=n(e)}),new c(r)}if(e(t)){var i={};return $.each(t,function(t,e){i[t]=n(e)}),new u(i)}return t}function i(t,e,r){switch(void 0===r&&(r={property:a.PROPERTY_TYPE_CONTEXT}),r.property){case a.PROPERTY_TYPE_CONTEXT:return void new y(e,t);case a.PROPERTY_TYPE_COMMAND:return void new d(e,r.path,t,r.property,r.trigger,r.parameter);case a.PROPERTY_TYPE_ITEMS:return void new f(e,r.path,t,r.property,r.converter);default:return void new l(e,r.path,t,r.property,r.mode,r.trigger,r.converter)}}var o={},a=function(){function t(){}return t.COLLECTION_ACTION_ADD="add",t.COLLECTION_ACTION_INSERT="insert",t.COLLECTION_ACTION_CLEAR="clear",t.COLLECTION_ACTION_REMOVE="remove",t.PROPERTY_TYPE_COMMAND="command",t.PROPERTY_TYPE_ITEMS="items",t.PROPERTY_TYPE_CONTEXT="context",t.BINDING_MODE_GET="get",t.BINDING_MODE_SET="set",t.BINDING_MODE_BIDIRECT="getset",t}();t.Constants=a;var s=function(){function t(t){void 0===t&&(t=[]),this.onCollectionChanged=new h,this.data=t}return t.prototype.add=function(t){var e=this.data.length;return this.data[e]=t,this.onCollectionChanged.trigger({action:a.COLLECTION_ACTION_ADD,index:e,item:t}),this},t.prototype.insert=function(t,e){return this.data.splice(t,0,e),this.onCollectionChanged.trigger({action:a.COLLECTION_ACTION_INSERT,index:t,item:e}),this},t.prototype.remove=function(t){return this.data.splice(t,1),this.onCollectionChanged.trigger({action:a.COLLECTION_ACTION_REMOVE,index:t}),this},t.prototype.clear=function(){return this.data.length=0,this.onCollectionChanged.trigger({action:a.COLLECTION_ACTION_CLEAR}),this},t.prototype.all=function(){return this.data},t.prototype.itemAt=function(t){return this.data[t]},Object.defineProperty(t.prototype,"CollectionChanged",{get:function(){return this.onCollectionChanged.expose()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"length",{get:function(){return this.data.length},enumerable:!0,configurable:!0}),t}();t.TypedObservableCollection=s;var c=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e}(s);t.ObservableCollection=c;var u=function(){function t(t){void 0===t&&(t={});var e=this;this.data={},this.onPropertyChanged=new h,$.each(t,function(t,r){r instanceof Function?e.addCommand(t,r):e.addProperty(t,r)})}return t.prototype.addProperty=function(t,e){var r=this;return this.data[t]=e,Object.defineProperty(this,t,{get:function(){return r.data[t]},set:function(e){r.data[t]!==e&&(r.data[t]=e,r.onPropertyChanged.trigger({property:t,value:e}))}}),this},t.prototype.addCommand=function(t,e){return this[t]=e,this},Object.defineProperty(t.prototype,"PropertyChanged",{get:function(){return this.onPropertyChanged.expose()},enumerable:!0,configurable:!0}),t.prototype.plain=function(){return this.data},t}();t.NotifyPropertyChanged=u;var h=function(){function t(){this.handlers=[]}return t.prototype.on=function(t){this.handlers.push(t)},t.prototype.off=function(t){this.handlers=this.handlers.filter(function(e){return e!==t})},t.prototype.trigger=function(t){this.handlers.slice(0).forEach(function(e){return e(t)})},t.prototype.expose=function(){return this},t}(),p=function(){function t(t,e,r,n,i){void 0===i&&(i=null);var a=this;if("^"===e.substr(0,1)){for(var s=r.closest("*[data-binding-context=context]");"^"===e.substr(0,1);)e=e.substr(1),s=s.parent().closest("*[data-binding-context=context]");t=s.data("binding-ctx")}this.context=t,this.pathParts=e?e.split("."):[],this.jquery=r,this.property=n,this.converter=i?o[i]:null;for(var c=this.context,u=0;u<this.pathParts.length-2&&void 0!==c;u++){var h=this.pathParts[u];c.PropertyChanged&&c.PropertyChanged.on(function(t){h===t.property&&a.parentChanged()}),c=c[h]}}return t.prototype.parentChanged=function(){},Object.defineProperty(t.prototype,"CtxValue",{get:function(){var t=this,e=this.context;return $.each(this.pathParts,function(r,n){if(void 0===e)return console.error("Path "+t.pathParts.join(".")+" does not exist!"),null;e=e[n]}),this.converter&&(e=this.converter.converter(e)),e},set:function(t){for(var e=this.context,r=0;r<this.pathParts.length-2;r++)e=e[this.pathParts[r]];this.converter&&this.converter.backConverter&&(t=this.converter.backConverter(t)),e[this.CtxProperty]=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"CtxProperty",{get:function(){return 0===this.pathParts.length?null:this.pathParts[this.pathParts.length-1]},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"CtxPath",{get:function(){return this.pathParts.join(".")},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"Ctx",{get:function(){return this.context},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"UiProperty",{get:function(){return this.property},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"Jquery",{get:function(){return this.jquery},enumerable:!0,configurable:!0}),t}(),l=function(t){function e(e,r,n,i,o,s,c){void 0===c&&(c=null);var u=t.call(this,e,r,n,i,c)||this;return u.setToUi(),o!==a.BINDING_MODE_SET&&(e.PropertyChanged?e.PropertyChanged.on(function(t){u.CtxProperty===t.property&&u.setToUi()}):console.warn("Context object of property [%s] is not a NotifyPropertyChanged!",i)),o!==a.BINDING_MODE_GET&&u.Jquery.on(s||"change",function(t){u.getFromUi()}),u}return __extends(e,t),e.prototype.parentChanged=function(){this.setToUi()},e.prototype.getFromUi=function(){switch(this.UiProperty){case"val":case"value":this.CtxValue=this.Jquery.val();break;case"checked":this.CtxValue=this.Jquery.is(":checked");break;case"text":this.CtxValue=this.Jquery.text();break;case"visibility":this.CtxValue=this.Jquery.css("display");break;case"enabled":this.CtxValue=this.Jquery.is(":disabled");break;default:if("style."===this.UiProperty.substr(0,6).toLowerCase()){var t=this.UiProperty.substr(6);this.CtxValue=this.Jquery.css(t);break}if("attribute."===this.UiProperty.substr(0,10).toLowerCase()){var e=this.UiProperty.substr(10);this.CtxValue=this.Jquery.attr(e);break}console.warn("Cannot get value from property %s!",this.UiProperty)}},e.prototype.setToUi=function(){switch(this.UiProperty){case"val":case"value":this.Jquery.val(this.CtxValue);break;case"checked":this.Jquery.prop("checked",this.CtxValue?"checked":null);break;case"text":this.Jquery.text(this.CtxValue);break;case"visibility":this.Jquery.css("display",this.CtxValue?"":"none");break;case"enabled":this.Jquery.attr("disabled",this.CtxValue?null:"disabled");break;default:if("style."===this.UiProperty.substr(0,6).toLowerCase()){var t=this.UiProperty.substr(6);this.Jquery.css(t,this.CtxValue);break}if("attribute."===this.UiProperty.substr(0,10).toLowerCase()){var e=this.UiProperty.substr(10);this.Jquery.attr(e,this.CtxValue);break}console.warn("Cannot set value to property %s!",this.UiProperty)}},e}(p),d=function(t){function e(e,r,n,i,o,a){var s=t.call(this,e,r,n,i)||this;return s.parameter=a,n.on(o||"click",function(t){s.call()}),s}return __extends(e,t),e.prototype.call=function(){var t=this.CtxValue;t?(console.log("Command ["+this.CtxPath+"] applied."),t.apply(this.Ctx,[this.parameter])):console.warn("Command ["+this.CtxPath+"] does not exist!")},e}(p),f=function(t){function e(e,r,n,i,o){void 0===o&&(o=null);var s=t.call(this,e,r,n,i,o)||this;if(s.Jquery.data("binding-ctx",e).attr("data-binding-context","context"),s.template=n.data("binding-template"),!s.template){var c=n.children().first();s.template=c[0].outerHTML,c.remove()}var u=s.CtxValue;return $.each(u.all()||u,function(t,e){s.addElement(e,t)}),u.CollectionChanged&&u.CollectionChanged.on(function(t){switch(console.log("List action [%s] index %d on [%s] executed (item %o).",t.action,t.index,s.CtxPath,t.item),t.action){case a.COLLECTION_ACTION_ADD:s.addElement(t.item,t.index);break;case a.COLLECTION_ACTION_INSERT:var e=s.addElement(t.item,t.index);0===t.index?s.Jquery.prepend(e):s.Jquery.children(":nth-child("+t.index+")").after(e);break;case a.COLLECTION_ACTION_REMOVE:s.Jquery.children(":nth-child("+(t.index+1)+")").remove();break;case a.COLLECTION_ACTION_CLEAR:n.empty()}}),s}return __extends(e,t),e.prototype.addElement=function(t,e){var r=this.template.replace(/\{\{([^\}]*)\}\}/gi,function(e){for(var r=[],n=1;n<arguments.length;n++)r[n-1]=arguments[n];var i=r[0];return t[i]}),n=$(r);return this.Jquery.append(n),i(n,t),n},e}(p),y=function(){function t(t,e){this.context=t,this.jquery=e,this.jquery.data("binding-ctx",t).attr("data-binding-context","context"),this.parseElements()}return t.prototype.parseElements=function(){var t=this;this.jquery.find("*[data-binding]").each(function(e,r){var n=$(r),o=n.data("binding").split("|");$.each(o,function(e,r){var o=t.parseOptions(r);i(n,t.context,o)})})},t.prototype.parseOptions=function(t){var e,r=/([^:]*):([^;]*)[;]{0,1}/gi,n={};do{(e=r.exec(t))&&(n[e[1]]=e[2])}while(e);return n},t}();t.registerConverter=function(t,e,r){void 0===r&&(r=null),o[t]={converter:e,backConverter:r}},t.simplifyObject=r,t.bindableObject=n,t.initialize=i}(Binding||(Binding={})),function(t,e){if(!e)return!1;e.fn.extend({binding:function(t,e){return void 0===e&&(e={property:Binding.Constants.PROPERTY_TYPE_CONTEXT}),Binding.initialize(this,t,e),this}})}(window,jQuery);